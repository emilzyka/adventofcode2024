// INPUT READING: 

//string input = "....#.....\r\n.........#\r\n..........\r\n..#.......\r\n.......#..\r\n..........\r\n.#..^.....\r\n........#.\r\n#.........\r\n......#...";
string input = "................................##..........................................................................#.......#.............\r\n...#.......................................................................................................#......................\r\n.#.....................#.............................................#................#..................#...#..#.#..#...#........\r\n.#........................#....#.#.#..........................................#...............................................#...\r\n..................#.......................................................#.......#.............#.................................\r\n........................................#...................................#.........#......#...............#......#......#......\r\n......#...#.......#..............#.....#..#....................#.................................................#......#.........\r\n......................#...................#....#....................................#.#........................#.........#...#....\r\n....................#..........................................................................................#..................\r\n..#.........................#.............#...............#.......................................................................\r\n.#...............................#...............................#...#................#.........#......................#..........\r\n...#.....................................#.........#.............#...................#.......#........................#......#....\r\n#...........................#............................#.............................#........................................#.\r\n.........................#................#...........#..........................#.#..............................................\r\n...........#.#.......#...#.............#.................................#............................................#...#.......\r\n....#.......................#.......#..........#....................................#...............................#.#..#........\r\n....#............#.......#.............................#..................#......#......#..............#.............#.....#.#....\r\n...................................#..............#............#...#..............................................#...............\r\n..............................#....#.#........#......................#...................#........#..#............................\r\n....................................#.#....#.............................................#....#......#...................#........\r\n..................##..................#........#.....#.........................................#.......#............#.............\r\n.............#......................................................##...................................................#......#.\r\n#......#................#.......................##...............#.....#.......................#..#.........#.............#...#...\r\n.............................................................................................................#.....#..............\r\n.......#..........#...............#.....##......#.......#.................#............#..........................................\r\n.......#.............#.........................................................#................................................#.\r\n...........#.......................#.....#...............#..............#........#.....#.........#.........................#......\r\n.........#........#...............#................................................................#......#..........#............\r\n..............#..................#...#...............................#.#.................................#.............#........#.\r\n.....................#.......#..............................#........................#...........#....#.................#.......#.\r\n..........#..................................#......#..#................##.........................................#..........#...\r\n.....................#.....#.........#.....#...............#..........................................#.........................#.\r\n..........#...#..............................#...................#.........#........................................#.............\r\n.......#.........................................................................#..........#............#..#..........#..........\r\n.....#..#..#...............#....................#..............#...........#.....#.....................#..........................\r\n................................................#.............................................................................#...\r\n................#.......................................................................................#.........................\r\n.............#...#.......................#..................................................#....#................................\r\n...............................#.......#.#.............................................#....................#....#................\r\n......#....................................................#.......#......#.................................................#.....\r\n...........................................................#..........................#.#.....#................#.................#\r\n....#....#............#.........................#..#.........................#..................#......#...#.........##...........\r\n...#..................#................................#......#.............#.#............................#......................\r\n..........................#.............................................................................##........................\r\n..............................................................................#.................#..........##.....................\r\n....#.....................#.................#......................#...........#.........................................#........\r\n..................................#..#....#.................................................................#............#.....#.#\r\n.#.........................#.........................#....................#......................................#................\r\n................##...........................#....................................................................................\r\n.........#........................................#...........................#........#.........#.......#......#.......#...#...#.\r\n.#..................................................................................#.........#..................................#\r\n....#...............#..........................#.....#....................................................#.......................\r\n.......................#.............................#......#...........^........#................................................\r\n#.#..#.....#...................##..........#...................................................................................#..\r\n..#....#.....................................................#...#.............#....#............#..#............................#\r\n........................#..........#.....#............#...........#...............#............#....#.................#........#..\r\n.................................#.............#...#..................#................................................#..........\r\n...........#............................................................................#................#....................#...\r\n..#.........#.............................#............................#....................#....................#................\r\n.................................#..#................#................#...........................................................\r\n.......................#.......................................#........................#................#......#...........#.....\r\n#..............#.......#.........#...#.....#......#.....................#...#....#.......................................#........\r\n.........#.#.............................#....#.......#..........................................................#................\r\n...#............................................................................................#.................................\r\n....................#...................#....................#..............#......#..#.............#.............................\r\n...........#.....................................................##...............................................................\r\n.....#......#...............................................................................#........#...................#........\r\n..............................................#.............#....#................................................................\r\n......................#.....................#........................................................#...#.........#..#.....#.....\r\n..#...............................................................#..#....................#.#.....................................\r\n............................................#...............#.....#.....#...#..#..................................................\r\n.#...........................................................................#....................................................\r\n.............................................................................................................#....................\r\n#....................................................#..............##.......................................#....................\r\n#..#....................#.......#...................................................................#...#.........................\r\n..#........................................#............#...............................................................#.........\r\n...............#...........................#...................#....#......#..................................#....#...........#.#\r\n..........##........#.........................#.......#..#.........#...............#........#........#..........#.................\r\n....##.......................................#...........#...................#......#.............................................\r\n..............................#.........#............................#.............................................#..............\r\n......#........#...........................#..................................#.....#.............................................\r\n...............#.........#.....#.............#.............#...............#.#...............................................#....\r\n........................................#...............................................................................##.#...#..\r\n................#.......#.....#........................................................................#........................#.\r\n....................................................................................#.........................................#...\r\n........................................................................................#...#.....................................\r\n........................#.#.........................................................................................#......#....##\r\n......#.........................#.............#...................................................................................\r\n................#...........................#..............#...#..........................#.......#......##.................#..#..\r\n....................................................#.#.................................#....#....................................\r\n#..................................#...............................................#......#.#.............#.......................\r\n.....#..........#.....................................................................................#.#.......#............#....\r\n..#.........................................................#...................#..................................#..###.#.....#.\r\n...#.#..........#.........#..#......................#..##...#.......#..#.#.#...............#.....#....#...........................\r\n...........#.....#...........#........................................................#..................#........................\r\n.................#........#.......#...................#...#.......#.....#........#..#.............................................\r\n...............................................#.......................#..................#.......................................\r\n....#...................#.#......#............#...................#..........#..##................................................\r\n....#........................#...........................................................#..................#..#.............#....\r\n............#...............................................#.....................................................................\r\n.........#.......#...................#...........#...............#....................#................#...#..#.......#...........\r\n...............#...........................................................................#.....................#................\r\n.............#....#.........................................................#............#....#.#....#.....#..#................#..\r\n..#...............#.........................................................#........##.....#...#.........................#.......\r\n..........................#.....................................#.................................#...............................\r\n..#.............#...#...............................#.................................................................##..........\r\n......#........#........................#..........................#..............................................#...............\r\n......#.........................#..#.............................................................................................#\r\n..................................................#..................#.....#...........#....#...#..........#................#.....\r\n....#.....................................#..........#.....#......#..........#....................................................\r\n...............................#...#...###.#.............................................................#...................#....\r\n...#...................................#.....#...#....................#........................#..#.......................#......#\r\n....#...#........#...................#..........#......................................#............#.............................\r\n#.................................#.....................#.................#................#...#.#................................\r\n.................................#.......#...........#..#...#......#.......#.........................#............................\r\n.......................................##..........................#..................................................#...........\r\n......#............#.##.........#...............#..........#....#.......................................#..#.................#....\r\n.....#............................#.....#..................................................#.......#......................#.......\r\n.............#.......................................................#...#...#....#...................#...........................\r\n......#.................#.#................................#..#...............#.............................#....#...........#....\r\n...............#...##......#.............................#.......................................#................................\r\n#..................................................#.........#....#....#.....#...................#.#....#.....#...................\r\n......#...#...##.................................................................#............................#...............#...\r\n.#..................................#.#...............#................................#...#......................................\r\n.........#.......#...#.......................#..................................................#.#................#..............\r\n..................#............................#.....#.....#........#.....................#........................#.......#..#...\r\n..#.............................#.............#.#................................................#.#.##....................#......\r\n.......#.#......................#.#.....................................................##.............#..........................\r\n..............#...#........................#................................#.........#.......................#..........#........\r\n.......................#...............................#..#.........#.............................................................";

List<List<char>> InputToList(string input)
{
    List<List<char>> output = [];
    string[] lines = input.Split(new[] { "\r\n" }, StringSplitOptions.RemoveEmptyEntries);

    foreach (var line in lines)
    {
        List<char> temp = [.. line];
        output.Add(temp);
    }
    return output;
}

// END INPUT

// Part 1

// get start pos
(int, int) GetStartPos(List<List<char>> l)
{
    var fstInd = l.FindIndex(list => list.Contains('^'));
    var sndInd = l[fstInd].IndexOf('^');
    return (fstInd, sndInd);
}

int MoveAndTrackDistincts(List<List<char>> l)
{
    HashSet<(int, int)> distincts = [];

    (var x, var y) = GetStartPos(l);

    string direction = "UP"; // assume start up
    bool isPresent = true;

    while (isPresent)
    {
        if (direction == "UP")
        {
            if (!IsStepInside(l, (x, y), direction)) break;

            if (l[(x - 1)][y] == '#') direction = ApplyRotationRule(direction);
            else
            {
                x -= 1;
                if (!distincts.Contains((x, y))) distincts.Add((x, y));
            }
        }

        if (direction == "RIGHT")
        {
            if (!IsStepInside(l, (x, y), direction)) break;

            if (l[(x)][y + 1] == '#') direction = ApplyRotationRule(direction);
            else
            {
                y += 1;
                if (!distincts.Contains((x, y))) distincts.Add((x, y));

            }
        }

        if (direction == "DOWN")
        {
            if (!IsStepInside(l, (x, y), direction)) break;


            if (l[(x + 1)][y] == '#') direction = ApplyRotationRule(direction);
            else
            {
                x += 1;
                if (!distincts.Contains((x, y))) distincts.Add((x, y));

            }
        }

        if (direction == "LEFT")
        {
            if (!IsStepInside(l, (x, y), direction)) break;

            if (l[(x)][y - 1] == '#') direction = ApplyRotationRule(direction);
            else
            {
                y -= 1;
                if (!distincts.Contains((x, y))) distincts.Add((x, y));

            }
        }

    }

    return distincts.Count;
}


bool IsStepInside(List<List<char>> l, (int x, int y) pos, string dir)
{
    var move = dir switch
    {
        "UP" => (pos.x - 1, pos.y),
        "RIGHT" => (pos.x, pos.y + 1),
        "DOWN" => (pos.x + 1, pos.y),
        "LEFT" => (pos.x, pos.y - 1),
        _ => (pos.x, pos.y)
    };

    return move.Item1 >= 0 && move.Item1 < l.Count && move.Item2 >= 0 && move.Item2 < l[move.Item1].Count;
}

string ApplyRotationRule(string s)
    => s switch
    {
        "UP" => "RIGHT",
        "RIGHT" => "DOWN",
        "DOWN" => "LEFT",
        "LEFT" => "UP",
        _ => "Unkown"
    };



var t = InputToList(input);
var d = MoveAndTrackDistincts(t);
Console.WriteLine($"Counts: {d}");